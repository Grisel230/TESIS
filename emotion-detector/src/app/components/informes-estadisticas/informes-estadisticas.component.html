<div class="dashboard-container" [class.dark-mode]="isDarkMode">
  <!-- Sidebar -->
  <div class="sidebar" [class.sidebar-hidden]="!sidebarVisible">
    <div class="sidebar-header">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <i class="menu-icon">☰</i>
        <span class="menu-text">Menú</span>
      </button>
    </div>
    
    <nav class="sidebar-nav">
      <a (click)="goToDashboard()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9,22 9,12 15,12 15,22"/>
        </svg>
        <span>Inicio</span>
      </a>
      <a (click)="goToNuevoPaciente()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="8.5" cy="7" r="4"/>
          <line x1="20" y1="8" x2="20" y2="14"/>
          <line x1="23" y1="11" x2="17" y2="11"/>
        </svg>
        <span>Agregar Paciente</span>
      </a>
      <a (click)="goToListaPacientes()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <span>Lista de Pacientes</span>
      </a>
      <a (click)="goToSesiones()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12,6 12,12 16,14"/>
        </svg>
        <span>Historial de Sesiones</span>
      </a>
      <a (click)="goToReports()" class="nav-item active">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="20" x2="18" y2="10"/>
          <line x1="12" y1="20" x2="12" y2="4"/>
          <line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
        <span>Informes y Estadísticas</span>
      </a>
      <a (click)="goToResources()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <span>Recursos</span>
      </a>
      <a (click)="goToSettings()" class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        <span>Configuración</span>
      </a>
    </nav>

    <!-- User Profile Section -->
    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar">
          <svg class="avatar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="user-info">
          <span class="user-name">{{ psicologo?.nombre_completo || 'Psicólogo' }}</span>
          <span class="user-role">Psicólogo</span>
        </div>
      </div>
      <a (click)="logout()" class="nav-item logout-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        <span>Cerrar Sesión</span>
      </a>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="main-content" [class.sidebar-collapsed]="!sidebarVisible">
    <!-- Floating Hamburger Button -->
    <button *ngIf="!sidebarVisible" class="floating-hamburger" (click)="toggleSidebar()" title="Mostrar menú">
      <svg class="hamburger-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
    
    <!-- Page Title -->
    <div class="page-title">
      <h1>Informes y Estadísticas</h1>
      <button class="export-button" (click)="exportReport()">
        <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7,10 12,15 17,10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Exportar Reporte
      </button>
    </div>
    
    <!-- Reports Card -->
    <div class="reports-card">
      <div class="card-header">
        <div class="card-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          <h3>Dashboard de Informes</h3>
        </div>
      </div>
      
      <!-- Stats Overview -->
      <div class="stats-overview" *ngIf="!isLoading">
      <div class="stat-card">
        <div class="stat-icon purple">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3v18h18"/>
            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ totalSessions }}</h3>
          <p>Total de Sesiones</p>
          <span class="stat-change">Registradas</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon blue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
            <line x1="9" y1="9" x2="9.01" y2="9"/>
            <line x1="15" y1="9" x2="15.01" y2="9"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ averageConfidence | number:'1.0-0' }}%</h3>
          <p>Confianza Promedio</p>
          <span class="stat-change">De detección</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon green">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ totalPatients }}</h3>
          <p>Pacientes Registrados</p>
          <span class="stat-change">Total</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon orange">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
            <line x1="9" y1="9" x2="9.01" y2="9"/>
            <line x1="15" y1="9" x2="15.01" y2="9"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>{{ predominantEmotion }}</h3>
          <p>Emoción Predominante</p>
          <span class="stat-change">General</span>
        </div>
      </div>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="isLoading" style="padding: 60px; text-align: center; color: #6b7280;">
      <p style="font-size: 18px; margin: 0;">Cargando estadísticas...</p>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <div class="chart-header">
          <h3>Distribución de Emociones</h3>
          <div class="chart-controls">
            <select class="period-select" [(ngModel)]="selectedPeriod">
              <option value="week">Esta semana</option>
              <option value="month">Este mes</option>
              <option value="quarter">Este trimestre</option>
              <option value="year">Este año</option>
            </select>
          </div>
        </div>
        <div class="chart-content">
          <div class="emotion-chart">
            <div class="emotion-bar" *ngFor="let emotion of emotionData">
              <div class="emotion-label">{{ emotion.label }}</div>
              <div class="emotion-bar-container">
                <div class="emotion-bar-fill" [style.width.%]="emotion.value" [style.background-color]="emotion.color"></div>
                <span class="emotion-percentage">{{ emotion.value }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="chart-container">
        <div class="chart-header">
          <h3>Sesiones por Mes</h3>
          <div class="chart-controls">
            <button class="btn-chart-type" (click)="toggleChartType()">
              {{ chartType === 'bar' ? 'Línea' : 'Barras' }}
            </button>
          </div>
        </div>
        <div class="chart-content">
          <div class="sessions-chart">
            <div class="chart-bars" *ngIf="chartType === 'bar'">
              <div class="chart-bar" *ngFor="let data of sessionData">
                <div class="bar-fill" [style.height.%]="(data.sessions / 25) * 100"></div>
                <span class="bar-label">{{ data.month }}</span>
                <span class="bar-value">{{ data.sessions }}</span>
              </div>
            </div>
            <div class="chart-line" *ngIf="chartType === 'line'">
              <svg viewBox="0 0 400 200" class="line-chart">
                <polyline 
                  [attr.points]="getLineChartPoints()" 
                  fill="none" 
                  stroke="#3b82f6" 
                  stroke-width="3"
                />
                <circle 
                  *ngFor="let data of sessionData; let i = index" 
                  [attr.cx]="(i * 50) + 25" 
                  [attr.cy]="200 - (data.sessions * 6)" 
                  r="4" 
                  fill="#3b82f6"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Detailed Reports -->
    <div class="reports-section">
      <div class="section-header">
        <h3>Reportes Detallados</h3>
        <div class="report-actions">
          <button class="btn-generate-report" (click)="generateReport()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            Generar Reporte
          </button>
        </div>
      </div>
      
      <div class="reports-grid">
        <div class="report-card" *ngFor="let report of availableReports">
          <div class="report-header">
            <div class="report-icon" [style.background-color]="report.color">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path [attr.d]="report.icon"></path>
              </svg>
            </div>
            <div class="report-info">
              <h4>{{ report.title }}</h4>
              <p>{{ report.description }}</p>
            </div>
          </div>
          <div class="report-actions">
            <button class="btn-view-report" (click)="viewReport(report)">
              Ver Reporte
            </button>
            <button class="btn-download-report" (click)="downloadReport(report)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="activity-section">
      <div class="section-header">
        <h3>Actividad Reciente</h3>
        <button class="btn-view-all" (click)="viewAllActivity()">
          Ver Todo
        </button>
      </div>
      
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivity">
          <div class="activity-icon" [style.background-color]="activity.color">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path [attr.d]="activity.icon"></path>
            </svg>
          </div>
          <div class="activity-content">
            <h4>{{ activity.title }}</h4>
            <p>{{ activity.description }}</p>
            <span class="activity-time">{{ activity.time }}</span>
          </div>
          <div class="activity-status" [class]="activity.status">
            {{ activity.statusText }}
          </div>
        </div>
      </div>
    </div>
    </div> <!-- Cierre de reports-card -->
  </div>
</div>

<!-- Modal de Reportes -->
<app-report-modal
  [isVisible]="isModalVisible"
  [reportData]="modalReportData"
  [reportType]="modalReportType"
  (closeModal)="closeModal()"
  (downloadReport)="onModalDownload($event)">
</app-report-modal>